<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Production Scheduler (Local Bryntum / Classic Light)</title>

  <!-- Load Bryntum Scheduler Pro from the same directory (public folder) -->
  <link rel="stylesheet" href="public/classic-light.css">
  <script src="public/schedulerpro.umd.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    #toolbar { margin-bottom: 10px; display: flex; gap: 10px; }
    button { padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }
    #container { height: 500px; border: 1px solid #eee; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Production Scheduler</h2>

  <div id="toolbar">
    <button id="forwardBtn">Forward Schedule (ASAP)</button>
    <button id="backwardBtn">Backward Schedule (ALAP)</button>
  </div>

  <div id="container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!window.bryntum || !window.bryntum.SchedulerPro) {
        document.body.innerHTML = '<h3 style="color:red">Bryntum Scheduler Pro could not be loaded from ./schedulerpro.umd.js</h3>';
        console.error('Bryntum Scheduler Pro not found on window.bryntum.');
        return;
      }

      const { SchedulerPro } = window.bryntum;

      const scheduler = new SchedulerPro({
        appendTo : 'container',
        startDate : new Date(2025, 9, 20, 8),
        endDate   : new Date(2025, 9, 20, 18),
        viewPreset : 'hourAndDay',

        project : {
          autoCalculate        : true,
          recalculateAfterLoad : true,
          constraintsMode      : 'honor',
          schedulingDirection  : 'forward',
          allowDependencyLag   : true,
          calculateCriticalPath: true
        },

        columns : [
          { type: 'resourceInfo', text: 'Resource', field: 'name', width: 160 }
        ],

        resources : [
          { id : 1, name : 'Machine A' },
          { id : 2, name : 'Machine B' }
        ],

        events : [
          { id : 1, name : 'Operation 1', resourceId : 1, startDate : '2025-10-20T08:00', duration : 2, durationUnit : 'h' },
          { id : 2, name : 'Operation 2', resourceId : 1, startDate : '2025-10-20T11:00', duration : 2, durationUnit : 'h' },
          { id : 3, name : 'Operation 3', resourceId : 2, startDate : '2025-10-20T09:00', duration : 3, durationUnit : 'h' }
        ],

        dependencies : [
          { fromEvent : 1, toEvent : 2, type : 0 },
          { fromEvent : 2, toEvent : 3, type : 0 }
        ],

        listeners : {
          beforeCalculate() { console.log('⏳ Scheduling calculation starting…'); },
          calculate()       { console.log('✅ Scheduling calculation complete.'); },
          conflict({ conflict }) { console.warn('⚠️ Scheduling conflict:', conflict); }
        }
      });

      async function runScheduling(mode) {
        scheduler.project.schedulingDirection = mode === 'ALAP' ? 'backward' : 'forward';
        await scheduler.project.propagate();
        scheduler.toast?.(`Schedule recalculated (${mode})`);
        console.log(`Recalculated (${mode})`);
      }

      document.getElementById('forwardBtn').addEventListener('click', () => runScheduling('ASAP'));
      document.getElementById('backwardBtn').addEventListener('click', () => runScheduling('ALAP'));
    });
  </script>
</body>
</html>